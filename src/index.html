<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Formulário de Pessoa</title>
    <link rel="stylesheet" href="/styles/output.css" />
  </head>
  <body class="bg-[#f4f4f4] flex justify-center items-center min-h-screen m-0">
    <div class="flex space-x-6">
      <div class="rounded-lg shadow-lg shadow-slate-500/50 w-72 p-6 bg-white">
        <h1 class="text-center mb-5 text-lg font-bold">Formulário de Pessoa</h1>
        <form id="formPessoa" class="flex flex-col">
          <label for="nome" class="mb-1 ml-1">Nome</label>
          <input
            type="text"
            name="nome"
            id="nome"
            class="mb-4 p-2 border rounded"
            required
          />

          <label for="cpf" class="mb-1 ml-1">CPF</label>
          <input
            type="text"
            name="cpf"
            id="cpf"
            class="mb-4 p-2 border rounded"
            required
          />

          <label for="telefone" class="mb-1 ml-1">Telefone</label>
          <input
            type="text"
            name="telefone"
            id="telefone"
            class="mb-4 p-2 border rounded"
            required
          />

          <button
            type="submit"
            class="p-2 bg-[#28a745] text-white border-none rounded-md cursor-pointer hover:bg-[#218838]"
          >
            Enviar
          </button>
        </form>
        <div id="message" class="mt-4 text-center"></div>
      </div>

      <div
        class="rounded-lg shadow-lg shadow-slate-500/50 w-[calc(100%-18rem)] p-6 bg-white"
      >
        <h2 class="text-center mb-4 text-lg font-bold">Pessoas Cadastradas</h2>
        <table id="pessoasTable" class="w-full border-collapse">
          <thead>
            <tr>
              <th class="border p-2">Nome</th>
              <th class="border p-2">CPF</th>
              <th class="border p-2">Telefone</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <script>
      document
        .getElementById("formPessoa")
        .addEventListener("submit", async (event) => {
          event.preventDefault();

          const nome = document.getElementById("nome").value;
          const cpf = document.getElementById("cpf").value;
          const telefone = document.getElementById("telefone").value;

          const personData = {
            Nome: nome,
            Cpf: cpf,
            Telefone: telefone,
          };

          try {
            const response = await fetch("http://localhost:3000/api/pessoas", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(personData),
            });

            const result = await response.json();

            if (response.ok) {
              document.getElementById("message").innerText =
                "Pessoa enviada com sucesso!";
              document.getElementById("formPessoa").reset();
              loadPessoas();

              setTimeout(() => {
                document.getElementById("message").innerText = "";
              }, 5000);
            } else {
              document.getElementById("message").innerText = `Erro: ${
                result.error || result.message || "Desconhecido"
              }`;
            }
          } catch (error) {
            document.getElementById("message").innerText =
              "Erro na comunicação com o servidor.";
          }
        });

      async function loadPessoas() {
        try {
          const response = await fetch("http://localhost:3000/api/pessoas");
          const pessoas = await response.json();

          const tableBody = document.querySelector("#pessoasTable tbody");
          tableBody.innerHTML = "";

          pessoas.forEach((person) => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td class="border p-2">${person.Nome}</td>
              <td class="border p-2">${person.Cpf}</td>
              <td class="border p-2">${person.Telefone}</td>
            `;
            tableBody.appendChild(row);
          });
        } catch (error) {
          console.error("Erro ao carregar pessoas:", error);
        }
      }

      document.addEventListener("DOMContentLoaded", loadPessoas);
    </script>
  </body>
</html>
